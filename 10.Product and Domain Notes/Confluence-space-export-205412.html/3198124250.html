<!DOCTYPE html>
<html>
    <head>
        <title>Jackson Fan : 3.1 Holdings Synapse — Technical One-Pager</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Jackson Fan</a></span>
                            </li>
                                                    <li>
                                <span><a href="JF-Space-Overview_2554888272.html">JF Space Overview</a></span>
                            </li>
                                                    <li>
                                <span><a href="Circuit-Breaker-notes_3198779447.html">Circuit Breaker notes</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Jackson Fan : 3.1 Holdings Synapse — Technical One-Pager
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                            
        
    
        
    
        
        
            Created by <span class='author'> Jackson Fan</span>, last modified on 08-06-25
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h2 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-1Businesspurpose">1 Business purpose</h2><p><em>Holdings Synapse</em> is the <strong>raw-load fact table</strong> that brings the <em>latest positions from the trading warehouse (Synapse)</em> into the Circuit Breaker tabular model.</p><p><br/>It answers <span style="background-color: rgb(211,241,167);">“</span><em><span style="background-color: rgb(211,241,167);">What securities and cash did each account own as of last night’s valuation?</span></em><span style="background-color: rgb(211,241,167);">” </span>and forms the golden-source side of every reconciliation (e.g., <strong>Daily Movements</strong>) and FUM roll-up.</p><p>(From Asset to some sort of Transactions facts &gt;&gt; Accounts table)</p><p><strong>This should be the main source of truth.</strong></p><hr/><h2 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-2Sourcequery&amp;lineage">2 Source query &amp; lineage</h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">SELECT  f.AccountKey,
        f.AssetID,
        f.AssetKey,
        i.FixedInterestAssetID,
        f.Quantity,
        f.Price,
        f.[Value NZD]
FROM    Trading.F_FundsUnderManagement_v AS f -- This seems to be the main table
LEFT JOIN Trading.Dim_FixedInterestAsset AS i -- assest that low risk and provided Fixed 
           ON i.FixedInterestAssetKey = f.FixedInterestAssetKey
WHERE   f.HoldingDateKey = (SELECT MAX(HoldingDateKey)
                            FROM Trading.F_FundsUnderManagement_v);
</pre>
</div></div><div class="table-wrap"><table data-table-width="1148" data-layout="center" data-local-id="f4457977-85a7-4da1-b723-dda0a74165c7" class="confluenceTable"><colgroup><col style="width: 343.0px;"/><col style="width: 421.0px;"/><col style="width: 382.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p>Stage</p></th><th class="confluenceTh"><p>Object</p></th><th class="confluenceTh"><p><strong>Comments</strong></p></th></tr><tr><td class="confluenceTd"><p>① <code>F_FundsUnderManagement_v</code></p></td><td class="confluenceTd"><p>Warehouse view; daily valuation for every account-asset.</p></td><td class="confluenceTd"><p /></td></tr><tr><td class="confluenceTd"><p>② <code>Dim_FixedInterestAsset</code></p></td><td class="confluenceTd"><p>Adds <code>FixedInterestAssetID</code> flag so Fixed-Interest vs. Equity can be derived.</p></td><td class="confluenceTd"><p> Fixed-Interest vs. Equity </p></td></tr><tr><td class="confluenceTd"><p>Filter</p></td><td class="confluenceTd"><p><code>HoldingDateKey = MAX()</code></p></td><td class="confluenceTd"><p>Pulls <strong>only the most recent snapshot</strong> (no history).</p></td></tr><tr><td class="confluenceTd"><p>Load</p></td><td class="confluenceTd"><p>Tabular partition <strong>“Holdings Synapse”</strong> (dataView = full)</p></td><td class="confluenceTd"><p>Table is completely replaced on each refresh.</p></td></tr></tbody></table></div><hr/><h2 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-3Rowgrain">3 Row grain</h2><p><strong>One row per </strong><code>(AccountKey, AssetKey)</code><strong> at the latest valuation date. (MAx of valuation date)</strong><br/>If the <strong>same security appears twice for an account in the source</strong> (rare corporate-action edge case) the join will duplicate rows here too.</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>What are the Corporate Actions might impact the same <strong>security</strong> Code?</p><p>Below is a quick-reference list of the corporate-action types most likely to make a <strong>single SecurityCode (ticker/ISIN)</strong> appear twice—or look “wrong”—in position data and reconciliations such as <strong>Daily Movements</strong>.</p></div></div><div class="table-wrap"><table data-table-width="1234" data-layout="center" data-local-id="c29fc48b-10b1-49e6-b62a-b0d9443998b7" class="confluenceTable"><colgroup><col style="width: 217.0px;"/><col style="width: 399.0px;"/><col style="width: 308.0px;"/><col style="width: 308.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p>Category</p></th><th class="confluenceTh"><p>Typical Event Codes*</p></th><th class="confluenceTh"><p>What changes</p></th><th class="confluenceTh"><p>Why duplicates / breaks occur</p></th></tr><tr><td class="confluenceTd"><p><strong>Share-count events</strong></p></td><td class="confluenceTd"><p><strong>SPLF</strong> (forward split), <strong>SPLR</strong> (reverse/consolidation), <strong>BONU</strong> (bonus issue)</p></td><td class="confluenceTd"><p>Quantity ↑ or ↓; price auto-adjusts</p></td><td class="confluenceTd"><p>If the warehouse loads <em>post-split</em> quantities before the tabular process, you’ll see both pre- and post-split rows on the same valuation date.</p></td></tr><tr><td class="confluenceTd"><p><strong>Rights / optional events</strong></p></td><td class="confluenceTd"><p><strong>RHDI</strong> (rights distribution), <strong>EXRI</strong> (rights exercise), <strong>DVOP</strong> (dividend reinvestment plan, DRP)</p></td><td class="confluenceTd"><p>New temporary code <em>and</em> movement on the parent SecurityCode</p></td><td class="confluenceTd"><p>Unexercised rights or DRP “phantom” lines can linger in Synapse while the model collapses them, causing value gaps.</p></td></tr><tr><td class="confluenceTd"><p><strong>Identifier / listing changes</strong></p></td><td class="confluenceTd"><p><strong>CHNG</strong> (ticker/ISIN change), <strong>NAME</strong> (legal name change), <strong>REDM</strong> (security re-designation)</p></td><td class="confluenceTd"><p>Same economic instrument, new SecurityCode or new AssetID</p></td><td class="confluenceTd"><p>If market data hubs roll the new code before accounting does, you get two rows that should net to one.</p></td></tr><tr><td class="confluenceTd"><p><strong>M&amp;A / spin-off</strong></p></td><td class="confluenceTd"><p><strong>MRGR</strong> (merger), <strong>SOFF</strong> (spin-off distribution), <strong>EXET</strong> (exchange offer)</p></td><td class="confluenceTd"><p>Parent’s quantity may shrink to zero; new child code appears</p></td><td class="confluenceTd"><p>During the “in-flight” day both parent and child can carry non-zero holdings.</p></td></tr><tr><td class="confluenceTd"><p><strong>Cash versus Script dividends</strong></p></td><td class="confluenceTd"><p><strong>DVCA</strong> (cash), <strong>DVSC</strong> (script/stock)</p></td><td class="confluenceTd"><p>Cash line + fractional shares</p></td><td class="confluenceTd"><p>DRP shares often settle one day after ex-date, leaving mismatched cash/stock postings.</p></td></tr><tr><td class="confluenceTd"><p><strong>Bond-specific events</strong></p></td><td class="confluenceTd"><p><strong>COUP</strong> (coupon), <strong>PARM</strong> (partial redemption), <strong>CONV</strong> (conversion to equity)</p></td><td class="confluenceTd"><p>Amortised cost, quantity, or even security type</p></td><td class="confluenceTd"><p>A convertible note may still be reported under the old code after some positions have already flipped to equity.</p></td></tr><tr><td class="confluenceTd"><p><strong>Capital returns</strong></p></td><td class="confluenceTd"><p><strong>CREV</strong> (capital reduction), <strong>CAPD</strong> (capital distribution)</p></td><td class="confluenceTd"><p>Price drop vs. cash received</p></td><td class="confluenceTd"><p>If the cash leg hits one system before the price adjustment, valuations diverge.</p></td></tr><tr><td class="confluenceTd"><p><strong>Delisting &amp; forced sales</strong></p></td><td class="confluenceTd"><p><strong>DLST</strong> (delist), <strong>TEND</strong> (tender offer), <strong>LIQU</strong> (liquidation)</p></td><td class="confluenceTd"><p>Position closed, proceeds booked under same code</p></td><td class="confluenceTd"><p>Timing differences on the final trade date can leave a “zero-price / positive-qty” orphan row.</p></td></tr></tbody></table></div><p>*Event-code mnemonics follow SWIFT/ISO 15022 where applicable; internal systems often have variants.</p><hr/><h3 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-Howitshowsupinyourdata">How it shows up in your data</h3><ol start="1"><li><p><strong>Duplicate AssetKey with different quantities or zero price</strong> – typical for splits and mergers.</p></li><li><p><strong>Same Quantity, different AssetKey</strong> (old vs. new listing) – ticker/ISIN change overs.</p></li><li><p><strong>One system nets to zero while the other still shows value</strong> – cash-first or stock-first processing of rights, tenders, and coupons.</p></li></ol><hr/><h3 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-PracticaltipsforSQLreconciliation">Practical tips for SQL reconciliation</h3><div class="table-wrap"><table data-table-width="1080" data-layout="center" data-local-id="27524931-5492-44d6-be31-854b35bbe79d" class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Check</p></th><th class="confluenceTh"><p>Quick logic</p></th></tr><tr><td class="confluenceTd"><p><em>Split ratio sanity</em></p></td><td class="confluenceTd"><p><code>ABS(preQty / postQty) IN (2,3,10,0.5,…)</code></p></td></tr><tr><td class="confluenceTd"><p><em>Ticker change map</em></p></td><td class="confluenceTd"><p>Maintain <code>TickerChangeHistory</code> table keyed by ISIN + effective date; join during ETL.</p></td></tr><tr><td class="confluenceTd"><p><em>Rights vs. parent roll-up</em></p></td><td class="confluenceTd"><p>Treat “RTS”/“R” suffixed tickers as part of parent when aggregating.</p></td></tr><tr><td class="confluenceTd"><p><em>Zero-price guards</em></p></td><td class="confluenceTd"><p>Flag rows where <code>Price = 0 AND Quantity ≠ 0</code> on a non-cash asset.</p></td></tr></tbody></table></div><hr/><h2 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-4Columnreference">4 Column reference</h2><div class="table-wrap"><table data-table-width="1154" data-layout="center" data-local-id="8e03bbda-9902-4cc8-91bd-1d436d923825" class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Column</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Comment</p></th></tr><tr><td class="confluenceTd"><p><code>AccountKey</code> <em>(PK in dim_Account)</em></p></td><td class="confluenceTd"><p>bigint</p></td><td class="confluenceTd"><p>Surrogate for joins.</p></td></tr><tr><td class="confluenceTd"><p><code>AssetID</code>, <code>AssetKey</code></p></td><td class="confluenceTd"><p>bigint</p></td><td class="confluenceTd"><p>Both kept so downstream calcs can use either warehouse or model key.</p></td></tr><tr><td class="confluenceTd"><p><code>FixedInterestAssetID</code></p></td><td class="confluenceTd"><p>bigint (nullable)</p></td><td class="confluenceTd"><p>Populated only for FI instruments; simplifies bond analytics.</p></td></tr><tr><td class="confluenceTd"><p><code>Quantity</code>, <code>Price</code>, <code>Value NZD</code></p></td><td class="confluenceTd"><p>double</p></td><td class="confluenceTd"><p>Latest position metrics (NZD value is <em>already</em> Quantity × Price × FX).</p></td></tr></tbody></table></div><blockquote><p><em>Note:</em> The table itself is <strong>hidden</strong> (<code>isHidden: true</code>) — exposed only via measures or downstream calc-tables.</p></blockquote><hr/><h2 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-5Built-inmeasures">5 Built-in measures</h2><div class="table-wrap"><table data-table-width="1112" data-layout="center" data-local-id="d7f3b345-69e8-4339-bb3d-c4fb0cc88eb3" class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Measure</p></th><th class="confluenceTh"><p>DAX logic</p></th><th class="confluenceTh"><p>Use case</p></th></tr><tr><td class="confluenceTd"><p><strong>HoldingsSynapseValue</strong></p></td><td class="confluenceTd"><p><code>SUM([Value NZD])</code> excluding markets on a deny-list s.MarketCode not in ('NZUNSU','Unlisted','AUNTA','NZNTA','AUUNSU','USUNSU')</p></td><td class="confluenceTd"><p>Core FUM figure for dashboards.</p><p>All the Unlisted assets are  the Assets that only existed itnernally and not listed on public market.</p></td></tr><tr><td class="confluenceTd"><p><strong>Cashman Synapse</strong></p></td><td class="confluenceTd"><p><code>SUM([Value NZD])</code> where <code>Assets[Is Cashman] = &quot;yes&quot;</code></p></td><td class="confluenceTd"><p>Instant view of total cash balances (for liquidity ratios).</p></td></tr></tbody></table></div><p>Both add <code>+0</code> to avoid BLANK propagation.</p><hr/><h2 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-6Keytechnicalobservations">6 Key technical observations</h2><div class="table-wrap"><table data-table-width="1138" data-layout="center" data-local-id="ae310c99-9a52-4df6-8daf-4ccf1e51ac52" class="confluenceTable"><colgroup><col style="width: 382.0px;"/><col style="width: 378.0px;"/><col style="width: 378.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p>Point</p></th><th class="confluenceTh"><p>Impact</p></th><th class="confluenceTh"><p>Recommendation</p></th></tr><tr><td class="confluenceTd"><p><strong>Latest-date sub-query</strong> (<code>MAX(HoldingDateKey)</code>)</p></td><td class="confluenceTd"><p>Forces full scan of the fact view every refresh.</p></td><td class="confluenceTd"><p>Cache the latest date in a small control table or materialized view to avoid repeated scans.</p></td></tr><tr><td class="confluenceTd"><p>Metrics stored as <strong>double</strong></p></td><td class="confluenceTd"><p>Risk of rounding error in big aggregates.</p></td><td class="confluenceTd"><p>Upstream change to <code>decimal(19,4)</code> where feasible; minimise conversions in DAX.</p></td></tr><tr><td class="confluenceTd"><p>Unused join to <code>dim_Asset</code> is commented</p></td><td class="confluenceTd"><p>Clears noisy equities but disabled.</p></td><td class="confluenceTd"><p>If business revives exclusion list, use a WHERE NOT <code>MarketCode IN (…)</code> rather than commented join.</p></td></tr><tr><td class="confluenceTd"><p>No partitioning by date</p></td><td class="confluenceTd"><p>Table reloads quickly today, but history loads will need new strategy.</p></td><td class="confluenceTd"><p>Introduce incremental partitions keyed on <code>HoldingDateKey</code> if multi-day slices become necessary.</p></td></tr><tr><td class="confluenceTd"><p>Table is hidden</p></td><td class="confluenceTd"><p>Shields self-service users from raw numbers, but modelers must rely on measures.</p></td><td class="confluenceTd"><p>Document where to find raw rows for debugging (Daily Movements / external tool).</p></td></tr></tbody></table></div><hr/><h2 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-7Typicaldataflowdiagram">7 Typical data flow diagram</h2><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">Synapse F_FundsUnderManagement_v ─┐              (latest day only)
                                  │ left join
Synapse Dim_FixedInterestAsset ───┘
        │
        ▼  (partition refresh)
    Holdings Synapse  (Circuit Breaker model, hidden)
        │                           │
        ├──► Measures (HoldingsSynapseValue, Cashman)
        │
        └──► Calc-table: Daily Movements (variance check)
</pre>
</div></div><hr/><h2 id="id-3.1HoldingsSynapse—TechnicalOne-Pager-8TL;DR">8 TL;DR</h2><p><em><strong>Holdings Synapse</strong></em><strong> is the “yesterday-night snapshot” of every account’s positions</strong>, pulled straight from the warehouse at refresh time.<br/>It provides the <span style="background-color: rgb(211,241,167);">authoritative NZ-dollar value and quantity for each </span><code>(Account, Asset)</code><span style="background-color: rgb(211,241,167);"> and fuels both compliance reconciliations and headline FUM metrics across the BI estate</span>.</p>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on 18-08-25 20:53</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
